<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Factors</title>
        <link rel="stylesheet" th:href="@{/style.css}" />
        <link rel="stylesheet" th:href="@{/webjars/bootstrap/3.3.5/css/bootstrap.min.css}" href="bootstrap.min.css"  media="screen" />        
    <style type="text/css">
    .node { stroke: #222; stroke-width: 1.5px; }
    .node.actor { fill: #888; }
    .node.movie { fill: #BBB; }
    .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; }
    #graph {margin-left: 30%;}    
    </style>
    </head>
    <body>        
        <div class="col-md-2">
            <div id="wrapper">               
                <div th:replace="common :: leftnav"></div>          
            </div>
        </div>
        <div class="col-md-10">
            <h1>Factors</h1>
            <form method="POST" >                
                <p th:text="${factors.isEmpty()} == false ? 'These are all the factors that are loaded in the database' : 'No factors in the database.'">These are all the factors that are loaded in the database</p>
                <table class="table table-hover" >
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>  
                            <th>Linked investments</th>
                            <th></th> <!--Delete -->                                                       
                        </tr>
                    </thead>
                    <tr th:each="factor : ${factors}">
                    <td>
                        <a th:href="|/factors/${factor.id}|" th:text="${factor.name}" />
                    </td>
                    
                    <td th:text="${factor.description}"></td>
                    <td> <a th:text="${factor.investments.size()}" th:href="|/factors/${factor.id}|"></a></td>
                    <td><a href="#" th:href="|/factors/${factor.id}/delete|">Delete</a></td>
                 </tr>
                </table>
            </form>
            <a class="btn btn-primary" th:href="|/NewFactor|">New Factor</a>
        </div>       
    <script src="@{/themes/jquery.js}" th:src="@{/webjars/jquery/2.1.4/jquery.min.js}"/>
    <script th:src="@{/webjars/bootstrap/3.3.5/js/bootstrap.min.js}"/>
    <script th:src="@{/webjars/d3js/3.5.17/d3.min.js}"/>
    <script th:src="@{/common.js}"/>
    <script th:inline="javascript">
    /*<![CDATA[*/
     $(document).ready(function(){
                console.log("JQuery Ready.");
                  $('[data-toggle="tooltip"]').tooltip();
              
    var width = 200, height = 200;

    var force = d3.layout.force()
            .charge(-100).linkDistance(50).size([width, height]);

    var svg = d3.select("#graph").append("svg")
            .attr("width", "100%").attr("height", "100%")
            .attr("pointer-events", "all");

    d3.json("http://localhost:8080/graph", function(error, graph) {
        if (error) return;

        force.nodes(graph.nodes).links(graph.links).start();

        var link = svg.selectAll(".link")
                .data(graph.links).enter()
                .append("line").attr("class", "link");

        var node = svg.selectAll(".node")
                .data(graph.nodes).enter()
                .append("circle")
                .attr("class", function (d) { return "node "+d.label })
                .attr("r", 10)                
                .call(force.drag);
       
    
        // html title attribute
        node.append("name")
                .text(function (d) { return d.name; })

    

        // force feed algo ticks
        force.on("tick", function() {
            link.attr("x1", function(d) { return d.source.x; })
                    .attr("y1", function(d) { return d.source.y; })
                    .attr("x2", function(d) { return d.target.x; })
                    .attr("y2", function(d) { return d.target.y; });

            node.attr("cx", function(d) { return d.x; })
                    .attr("cy", function(d) { return d.y; });
        });
        
    });
});  
    /*]]>*/
    </script>
    </body>
</html>