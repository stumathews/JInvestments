<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Investment Tracking</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" th:href="@{/style.css}" />
        <link rel="stylesheet" th:href="@{/webjars/bootstrap/3.3.5/css/bootstrap.min.css}" href="bootstrap.min.css"  media="screen" />        
         <style type="text/css">
            .node { stroke: #222; stroke-width: 1.5px; fill:rgba(255,0,0,50) }
            .node.investment { fill: #888; }
            .node.movie { fill: #BBB; }
            .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; } 
            #graph { margin-bottom:10px; }
            svg.text { margin-left:120px; }
    </style>
    </head>
    <body>        
        <div class="col-md-2">
            <div id="wrapper">               
                <div th:replace="common :: leftnav"></div>          
            </div>
        </div>
        <div class="col-md-10">
            <h2>Summary</h2> 
            <dl class="dl-horizontal">
                <dt>Investments</dt>
                <dd><a th:href="@{/investments/}" th:text="${investments.size()}">a</a></dd>
                <dt>Factors</dt>
                <dd><a th:href="@{/factors}" th:text="${factors.size()}">a</a></dd>
                <dt>Groups</dt>
                <dd><a th:href="@{/group}" th:text="${groups.size()}">a</a></dd>
                <dt>Risks</dt>
                <dd><a th:href="@{/risk}" th:text="${risks.size()}">a</a></dd>
            </dl>
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#regions">Linked regions</a></li>
                <li><a data-toggle="tab" href="#factors">Linked factors</a></li>                
                <li><a data-toggle="tab" href="#groups">Linked groups</a></li>                
                <li><a data-toggle="tab" href="#risks">Linked risks</a></li>  
            </ul>   
             <div class="tab-content">                
                <div id="regions" class="tab-pane fade"> 
                     <div id="graph"/>
                </div> 
                
                <div id="factors" class="tab-pane fade"> 
                todo
                </div>
                    
                <div id="groups" class="tab-pane fade"> 
                todo
                </div>

                <div id="risks" class="tab-pane fade"> 
                todo
                </div>                
             </div>              
        </div>       
        
    <script src="@{/themes/jquery.js}" th:src="@{/webjars/jquery/2.1.4/jquery.min.js}"/>
    <script th:src="@{/webjars/bootstrap/3.3.5/js/bootstrap.min.js}"/>
    <script th:src="@{/webjars/d3js/3.5.17/d3.min.js}"/>
    <script th:src="@{/common.js}"/>
    <script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function(){
        console.log("JQuery Ready.");              
              
    var width = 500, height = 200;

    var force = d3.layout.force()
            .charge(-350).linkDistance(50).size([width, height]);

    var svg = d3.select("#graph")
            .append("svg")
            .attr("viewBox", "0 0 700 300")            
            .attr("pointer-events", "all");

    d3.json("http://localhost:8080/graph", function(error, graph) {
        if (error) return;

        force.nodes(graph.nodes).links(graph.links).start();

        var link = svg.selectAll(".link")
                .data(graph.links).enter()
                .append("line").attr("class", "link");

        var node = svg.selectAll(".node")
                .data(graph.nodes)
                .enter()
                .append("circle")
                .attr("class", function (d) { return "node "+d.label; })
                .attr("r", 5)                
                .call(force.drag);       

        var text = svg 
                .selectAll("text")
                .data(graph.nodes)
                .enter()
                .append("a")
                .attr("href","www.example.com")
                .append("text")                
                .text(function (d) { return d.name; })
                .attr("font-family", "sans-serif")
		.attr("font-size", "11px")
		.attr("fill", "green");


        // force feed algo ticks
        force.on("tick", function() {
            link.attr("x1", function(d) { return d.source.x; })
                    .attr("y1", function(d) { return d.source.y; })
                    .attr("x2", function(d) { return d.target.x; })
                    .attr("y2", function(d) { return d.target.y; });

            node.attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });
            text.attr("x", function(d){ return d.x+10; });
            text.attr("y", function(d){ return d.y+10; });
        });
        
    });
});  
    /*]]>*/
    </script>
    </body>
</html>